{% extends "base.html" %}
{% load static %}

{% block css_files %}
    <link rel="stylesheet" href="{% static 'physik/aufgabe.css' %}">
{% endblock %}

{% block content %}
    <form method="post">
    {% csrf_token %}
        <div class="task-dialog">

            <!-- Kopfzeile -->
            <div class="task-header">
              <div class="task-title">
                  {{ fragenummer }} von {{ anzahl }} Aufgaben
              </div>
              <div class="task-kapitel">
                  {{ aufgabe.kapitel }}
              </div>
            </div>
            {% if messages %}
              {% for message in messages %}
                  <div class="alert {{ message.tags }}">
                  {{ message }}
                  </div>
              {% endfor %}
            {% endif %}

            <!-- Frage -->
            <div class="task-frage">
                {{ aufgabe.frage }}
            </div>

            <!-- Antwortbereich -->
            <div class="task-antwort">
              {% if aufgabe.typ == "l" %}
                {% for a in anzeigen %}
                <div class="task-option">
                  <label>
                    <input type="radio"
                          name="antwort"
                          value="{{ a.text }}"
                          {% if warte_auf_weiter %}disabled{% endif %}>
                    {{ a.text }}
                  </label>
                </div>
                {% endfor %}
              {% else %}
                <input type="text"
                      name="antwort"
                      class="task-input"
                      value="{{ letzte_antwort }}"
                      {% if warte_auf_weiter %}disabled{% endif %}>
                <span class="task-einheit">{{ aufgabe.einheit }}</span>
              {% endif %}

            </div>

            <div id="solutionBox" style="display:none;" class="solution-box">
            <strong>Lösung:</strong><br>
            {{ aufgabe.antwort }}<br><br>

            {% if aufgabe.erklaerung %}
                {{ aufgabe.erklaerung|linebreaks }}
            {% endif %}
            </div>
            {% if bilder %}
              {% with bilder_liste=bilder %}
                <div class="task-images row1">
                  {% for b in bilder_liste %}
                    {% if forloop.counter <= 2 %}
                      <img src="{{ b.bild.url }}"
                          class="task-image clickable"
                          data-id="{{ b.id }}">
                    {% endif %}
                  {% endfor %}
                </div>

                {% if bilder_liste|length > 2 %}
                  <div class="task-images row2">
                    {% for b in bilder_liste %}
                      {% if forloop.counter > 2 %}
                        <img src="{{ b.bild.url }}"
                            class="task-image clickable"
                            data-id="{{ b.id }}">
                      {% endif %}
                    {% endfor %}
                  </div>
                {% endif %}
              {% endwith %}

              <input type="hidden" name="bild_antwort" id="bild_antwort">
            {% endif %}


            <!-- Button-Leiste -->
            <div class="task-buttons">
                <button type="button" onclick="location.href='/'">Stop</button>
                {% if aufgabe.hilfe %}
                    <button type="button" onclick="alert('{{ aufgabe.hilfe|escapejs }}')">
                    Hilfe
                    </button>
                {% endif %}
                <button type="button" id="showSolution">Lösung anzeigen</button>
                <button type="submit">Weiter</button>
            </div>
        </div>
    </form>

  <script>
  const warte = {{ warte_auf_weiter|yesno:"true,false" }};
  document.addEventListener("DOMContentLoaded", function () {
    if (!warte) {
      document.querySelectorAll(".task-image.clickable").forEach(img => {
        img.addEventListener("click", function () {
          document.getElementById("bild_antwort").value = this.dataset.id;

          document.querySelectorAll(".task-image")
                  .forEach(i => i.classList.remove("selected"));

          this.classList.add("selected");
        });
      });
    }
  });
  </script>

  <script>
  document.getElementById("showSolution").addEventListener("click", function () {
    const box = document.getElementById("solutionBox");
    box.style.display = (box.style.display === "none") ? "block" : "none";
  });
  </script>


{% endblock %}

